<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>教师主页</title>
    <!-- 引入 Element UI 的 CSS 文件 -->
    <link rel="stylesheet" href="element-ui/lib/theme-chalk/index.css">
    <style>
        #app {
            display: flex;
            height: 100vh;
        }
        #sidebar {
            width: 200px;
            background-color: #f0f2f5;
            padding: 20px;
        }
        #content {
            flex: 1;
            padding: 20px;
        }
        .container {
            margin: 20px;
        }
        .course-item {
            margin-bottom: 20px;
            border: 1px solid #ccc;
            padding: 10px;
        }
        .student-item {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
<div id="app">
    <!-- 左侧导航栏 -->
    <div id="sidebar">
        <el-menu :default-active="currentView" class="el-menu-vertical-demo" @select="handleMenuSelect">
            <el-menu-item index="teacherInfo">个人信息</el-menu-item>
            <el-menu-item index="createCourse">创建课程</el-menu-item>
            <el-menu-item index="manageCourses">管理课程</el-menu-item>
            <el-menu-item index="viewStudents">查看报名学生情况</el-menu-item>
            <el-menu-item index="addQuestions">添加题目</el-menu-item>
            <el-menu-item index="viewAnswers">查看学生答题情况</el-menu-item>
        </el-menu>
    </div>

    <!-- 右侧内容区域 -->
    <div id="content" class="container">
        <div v-show="currentView === 'teacherInfo'">
            <h1>个人信息页面</h1>
            <div class="info-item">
                <p>姓名：{{ userInfo.name }}</p>
            </div>
            <div class="info-item">
                <p>Email：{{ userInfo.email }}</p>
            </div>
            <div class="info-item">
                <p>QQ号：{{ userInfo.qq }}</p>
            </div>
            <div class="info-item">
                <p>个人简介：{{ userInfo.introduction }}</p>
            </div>
            <!-- 修改按钮 -->
            <el-button type="primary" @click="handleEdit">修改信息</el-button>
            <!-- 修改表单 -->
            <div v-show="isEditing">
                <!-- 在这里添加修改表单 -->
                <el-form :model="editForm" label-width="80px">
                    <el-form-item label="用户名">
                        <el-input v-model="editForm.username" :disabled="true"></el-input>
                    </el-form-item>
                    <el-form-item label="密码">
                        <el-input v-model="editForm.password" type="password"></el-input>
                    </el-form-item>
                    <el-form-item label="姓名">
                        <el-input v-model="editForm.name"></el-input>
                    </el-form-item>
                    <el-form-item label="Email">
                        <el-input v-model="editForm.email"></el-input>
                    </el-form-item>
                    <el-form-item label="QQ号">
                        <el-input v-model="editForm.qq"></el-input>
                    </el-form-item>
                    <el-form-item label="个人简介">
                        <el-input type="textarea" v-model="editForm.introduction"></el-input>
                    </el-form-item>
                    <el-form-item>
                        <el-button type="primary" @click="submitEdit">提交修改</el-button>
                    </el-form-item>
                </el-form>
            </div>
        </div>
        <div v-show="currentView === 'createCourse'">
            <h1>创建课程页面</h1>
            <!-- 创建课程表单 -->
            <el-form :model="createCourseForm" label-width="80px">
                <el-form-item label="课程名字">
                    <el-input v-model="createCourseForm.name"></el-input>
                </el-form-item>
                <el-form-item label="描述">
                    <el-input type="textarea" v-model="createCourseForm.description"></el-input>
                </el-form-item>
                <el-form-item label="开始日期">
                    <el-input v-model="createCourseForm.start_date" placeholder="YYYY-MM-DD"></el-input>
                </el-form-item>
                <el-form-item label="结束日期">
                    <el-input v-model="createCourseForm.end_date" placeholder="YYYY-MM-DD"></el-input>
                </el-form-item>
                <el-form-item label="最大学生数量">
                    <el-input v-model="createCourseForm.capacity" type="number"></el-input>
                </el-form-item>
                <el-form-item>
                    <el-button type="primary" @click="submitCreateCourse">创建课程</el-button>
                </el-form-item>
            </el-form>
        </div>
        <div v-show="currentView === 'manageCourses'">
            <h1>管理课程页面</h1>
            <div class="course-item" v-for="course in courses" :key="course.id">
                <h2>{{ course.name }}</h2>
                <p>描述：{{ course.description }}</p>
                <p>开始日期：{{ course.start_date }}</p>
                <p>结束日期：{{ course.end_date }}</p>
                <p>最大学生数量：{{ course.capacity }}</p>
                <el-button type="text" @click="goToQuestions(course)">查看题目</el-button>
                <el-button type="text" @click="goToChapters(course)">进入章节</el-button>
                <el-button type="primary" @click="editCourse(course)">编辑</el-button>
                <el-button type="danger" @click="deleteCourse(course)">删除</el-button>
            </div>
            <div v-show="isEditingCourse">
                <h2>编辑课程</h2>
                <el-form :model="editCourseForm" label-width="80px">
                    <el-form-item label="课程名字">
                        <el-input v-model="editCourseForm.name"></el-input>
                    </el-form-item>
                    <el-form-item label="描述">
                        <el-input type="textarea" v-model="editCourseForm.description"></el-input>
                    </el-form-item>
                    <el-form-item label="开始日期">
                        <el-input v-model="editCourseForm.start_date" placeholder="YYYY-MM-DD"></el-input>
                    </el-form-item>
                    <el-form-item label="结束日期">
                        <el-input v-model="editCourseForm.end_date" placeholder="YYYY-MM-DD"></el-input>
                    </el-form-item>
                    <el-form-item label="最大学生数量">
                        <el-input v-model="editCourseForm.capacity" type="number"></el-input>
                    </el-form-item>
                    <el-form-item>
                        <el-button type="primary" @click="submitEditCourse">提交修改</el-button>
                        <el-button @click="cancelEditCourse">取消</el-button>
                    </el-form-item>
                </el-form>
            </div>
        </div>
        <div v-show="currentView === 'viewStudents'">
            <h1>查看报名学生情况页面</h1>
            <div v-for="courseData in courseStudentList" :key="courseData.course.id">
                <h2>{{ courseData.course.name }}</h2> <!-- 显示课程名称 -->
                <!-- 循环遍历课程下的学生信息 -->
                <div v-for="student in courseData.students" :key="student.id">
                    <p>姓名：{{ student.name }}</p>
                    <p>年级：{{ student.grade }}</p>
                    <p>介绍：{{ student.introduction }}</p>
                </div>
            </div>
        </div>
        <div v-show="currentView === 'addQuestions'">
            <h1>添加题目页面</h1>
            <!-- 添加题目表单 -->
            <el-form :model="questionForm" label-width="80px">
                <el-form-item label="选择课程">
                    <el-select v-model="questionForm.courseId" placeholder="请选择课程">
                        <el-option v-for="course in courses" :key="course.id" :label="course.name" :value="course.id"></el-option>
                    </el-select>
                </el-form-item>
<!--                <el-form-item label="题目名称">
                    <el-input v-model="questionForm.name"></el-input>
                </el-form-item>-->
                <el-form-item label="题目描述">
                    <el-input type="textarea" v-model="questionForm.description"></el-input>
                </el-form-item>
                <el-form-item label="题目答案">
                    <el-input v-model="questionForm.answer"></el-input>
                </el-form-item>
                <el-form-item>
                    <el-button type="primary" @click="submitQuestion">提交题目</el-button>
                </el-form-item>
            </el-form>
            <a href="TeacherMain.html">返回主页</a>
        </div>
        <!-- 查看学生答题情况页面 -->
        <div v-show="currentView === 'viewAnswers'">
            <h1>查看学生答题情况页面</h1>
            <el-form :model="form" label-width="80px">
                <el-form-item label="选择课程">
                    <el-select v-model="form.courseId" placeholder="请选择课程" @change="loadStudentRecords">
                        <el-option v-for="course in courses" :key="course.id" :label="course.name" :value="course.id"></el-option>
                    </el-select>
                </el-form-item>
            </el-form>
            <div v-if="records.length === 0">暂无学生答题记录</div>
            <div v-else>
                <div class="record-item" v-for="(record, index) in records" :key="index">
                    <p>课程id：{{ record.course_id }}</p>
                    <p>题目id：{{ record.question_id }}</p>
                    <p>学生答案：{{ record.student_answer }}</p>
                    <p>回答时间：{{ record.time}}</p>
                    <p>得分：{{ record.score }}</p>
                </div>
            </div>
            <a href="TeacherMain.html">返回主页</a>
        </div>
        <div v-show="currentView === 'statistics'">
            <h1>统计分析页面</h1>
            <!-- 统计图表等 -->
        </div>
        <div v-show="currentView === 'discussion'">
            <h1>讨论区页面</h1>
            <!-- 讨论区内容 -->
        </div>
    </div>
</div>

<!-- 引入 Vue.js 和 Element UI 的 JavaScript 文件 -->
<script src="js/axios-0.18.0.js"></script>
<script src="js/vue.js"></script>
<script src="element-ui/lib/index.js"></script>
<script>
    new Vue({
        el: '#app',

        data() {
            return {
                currentView: 'teacherInfo',
                userInfo: {}, // 存储用户信息
                editForm: {}, // 存储修改后的信息
                isEditing: false, // 是否处于编辑状态
                isEditingCourse: false, // 是否处于编辑课程状态
                editCourseForm: {}, // 存储编辑后的课程信息
                currentCourse: {}, // 存储当前正在编辑的课程对象
                createCourseForm: { // 创建课程表单数据
                    name: '',
                    description: '',
                    start_date: '',
                    end_date: '',
                    capacity: ''
                },
                courses: [], // 存储课程列表
                courseStudentList: [],// 存储课程和学生信息的数组
                questionForm: { // 添加题目表单数据
                    courseId: '', // 选择的课程ID

                    description: '',
                    answer: ''
                },
                form: {
                    courseId: '' // 选择的课程ID
                },
                records: [] // 存储学生答题记录
            };
        },
        methods: {
            // 加载用户信息
            loadUserInfo() {
                axios.get('teacherInfoServlet')
                    .then(response => {
                        this.userInfo = response.data;
                        this.editForm = {...this.userInfo};
                    })
                    .catch(error => {
                        console.error('Error loading user info:', error);
                    });
            }, goToChapters(course) {
                // 获取要跳转的课程ID
                const courseId = course.id;
                // 使用window.location.href进行页面跳转，将课程ID作为参数传递给章节页面
                window.location.href = 'chapter-editor.html?courseId=' + courseId;
            },
            goToQuestions(course) {
                const courseId = course.id;
                // 构建目标页面的 URL，包括课程 ID
                const destinationURL = 'questions-page.html?courseId=' + courseId;
                // 跳转到目标页面
                window.location.href = destinationURL;
            },

            // 加载课程列表
            loadCourses() {
                axios.get('/try2/getCoursesServlet')
                    .then(response => {

                        this.courses = response.data;

                    })
                    .catch(error => {
                        console.error('Error loading courses:', error);
                    });
            },
            // 加载报名学生列表
            loadStudents() {
                axios.get('getStudentsServlet')
                    .then(response => {
                        // 将每个课程和学生信息合并为一个对象，并放入数组中
                        this.courseStudentList = response.data;
                    })
                    .catch(error => {
                        console.error('Error loading students:', error);
                    });
            },
            // 加载学生答题记录
            loadStudentRecords() {
                axios.post('getStudentRecordsServlet')
                    .then(response => {
                        this.records = response.data;
                    })
                    .catch(error => {
                        console.error('Error loading student records:', error);
                    });
            },
            // 处理左侧导航栏点击事件
            handleMenuSelect(index) {
                this.currentView = index;
                if (index === 'manageCourses') {
                    this.loadCourses();
                } else if (index === 'viewStudents') {
                    this.loadStudents();
                }else if(index === 'viewAnswers'){
                    this.loadStudentRecords();
                }
            },
            // 处理点击修改按钮
            handleEdit() {
                this.isEditing = true;
            },
            // 提交修改
            submitEdit() {

                axios.post('/try2/editTeacherInfoServlet', this.editForm)
                    .then(response => {
                        this.$message.success('修改成功')
                        console.log('Submit edit clicked')
                        console.log('Info updated successfully:', response.data);
                        this.loadUserInfo();
                        this.isEditing = false;

                    })
                    .catch(error => {
                        console.error('Error updating user info:', error);
                    });
            },
            // 提交创建课程
            submitCreateCourse() {
                axios.post('/try2/createCourseServlet', this.createCourseForm)
                    .then(response => {
                        console.log('Course created successfully:', response.data);
                        this.createCourseForm = {
                            name: '',
                            description: '',
                            start_date: '',
                            end_date: '',
                            capacity: ''
                        };
                        this.$message.success('创建成功')
                        this.loadCourses();
                    })
                    .catch(error => {
                        console.error('Error creating course:', error);
                    });
            },
            // 编辑课程
            editCourse(course) {
                this.isEditingCourse = true;
                // 设置当前正在编辑的课程对象
                this.currentCourse = course;
                // 将课程信息填充到编辑表单中
                this.editCourseForm = { ...course };
            },

            // 提交编辑课程
            submitEditCourse() {
                axios.post('/try2/editCourseServlet', this.editCourseForm)
                    .then(response => {
                        console.log('Course edited successfully:', response.data);
                        // 清空表单
                        this.editCourseForm = {
                            id: '',
                            name: '',
                            description: '',
                            startDate: '',
                            endDate: '',
                            maxStudents: ''
                        };
                        // 隐藏编辑表单
                        this.isEditingCourse = false;
                        // 重新加载课程列表
                        this.loadCourses();
                    })
                    .catch(error => {
                        console.error('Error editing course:', error);
                    });
            },

            // 取消编辑课程
            cancelEditCourse() {
                this.isEditingCourse = false;
                // 清空编辑表单
                this.editCourseForm = {};
            },
            // 删除课程
            deleteCourse(course) {
                const  id=course.id;
                axios.post('/try2/deleteCourseServlet', { courseId: id })
                    .then(response => {
                        console.log('Course deleted successfully:', response.data);
                        // 重新加载课程列表
                        this.loadCourses();
                    })
                    .catch(error => {
                        console.error('Error deleting course:', error);
                    });
            },
            // 提交题目
            submitQuestion() {
                axios.post('addQuestionServlet', this.questionForm)
                    .then(response => {
                        console.log('Question added successfully:', response.data);
                        // 清空表单
                        this.questionForm.courseId = '';

                        this.questionForm.description = '';
                        this.questionForm.answer = '';
                        // 提示用户添加成功
                        this.$message.success('题目添加成功！');
                    })
                    .catch(error => {
                        console.error('Error adding question:', error);
                        // 提示用户添加失败
                        this.$message.error('题目添加失败，请重试！');
                    });
            }
        },
        mounted() {
            this.loadUserInfo(); // 加载用户信息
            // 根据当前视图加载相应的数据
            if (this.currentView === 'manageCourses') {
                this.loadCourses(); // 加载课程列表
            } else if (this.currentView === 'viewStudents') {
                this.loadStudents(); // 加载学生列表
            }else if(this.currentView === 'viewAnswers'){
                this.loadStudentRecords()
            }

        }

    });
</script>
</body>
</html>
